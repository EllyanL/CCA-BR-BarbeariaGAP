<mat-card class="tabela-card" *ngIf="usuarioCarregado && horariosCarregados; else carregandoHorarios">
  <mat-card-content class="tabela-card-content">
    <!-- Mensagem de Feedback -->
    <div *ngIf="feedbackMessageTitle" class="feedback-message">
      {{ feedbackMessageTitle }}
    </div>
    <ng-template #indisponivel>
      <button mat-raised-button disabled [ngClass]="'INDISPONIVEL' | statusFormat : 'tabelaClass'">
        {{ 'INDISPONIVEL' | statusFormat }}
      </button>
    </ng-template>

    <!-- Tabela Principal -->
    <ng-container *ngIf="horariosGrade$ | async as grade">
      <table class="tabela">
        <thead class="tabela-header">
          <tr>
            <th>HORÁRIO</th>
            <th *ngFor="let dia of diasDaSemana; let i = index; trackBy: trackByDia" class="tabela-header-dia">
              {{ (diaLabelMap[dia] + ' - ' + diasComData[i]) | uppercase }}
            </th>
          </tr>
        </thead>
        <tbody class="tabela-body">
          <tr *ngFor="let hora of grade.horas; trackBy: trackByHora" class="tabela-linha-horario">
            <td class="tabela-coluna-horario">
              {{ hora }}
            </td>
            <td *ngFor="let dia of diasDaSemana; trackBy: trackByDia" class="tabela-coluna-dia">
              <ng-container *ngIf="getSlot(dia, hora, grade.horarios) as slot; else indisponivel">
                <button
                  mat-raised-button
                  [disabled]="!podeInteragirComSlot(slot, dia, hora)"
                  [color]="slot.status === 'DISPONIVEL' ? 'primary' : undefined"
                  [ngClass]="[
                    slot.status | statusFormat : 'tabelaClass',
                    deveDestacarSlot(slot, dia, hora) ? 'botao-agendado-proprio' : null
                  ]"
                  (click)="handleClick(getAgendamentoParaDiaHora(dia, hora), dia, hora)"
                >
                  {{ slot.status | statusFormat }}
                </button>
              </ng-container>
            </td>
          </tr>
        </tbody>
      </table>
    </ng-container>

  </mat-card-content>
</mat-card>

<ng-template #carregandoHorarios>
  <mat-card class="tabela-card tabela-loading-card">
    <mat-card-content class="tabela-loading-content">
      <mat-spinner diameter="48"></mat-spinner>
      <span class="tabela-loading-text">Carregando horários...</span>
    </mat-card-content>
  </mat-card>
</ng-template>
