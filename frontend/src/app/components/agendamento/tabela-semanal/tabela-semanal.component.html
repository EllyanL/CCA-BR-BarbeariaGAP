<mat-card class="tabela-card" *ngIf="usuarioCarregado">
  <mat-card-content class="tabela-card-content">
    <!-- Mensagem de Feedback -->
    <div *ngIf="feedbackMessageTitle" class="feedback-message">
      {{ feedbackMessageTitle }}
    </div>

    <!-- Tabela Principal -->
    <table class="tabela">
      <thead class="tabela-header">
        <tr>
          <th>HORÁRIO</th>
          <th *ngFor="let labelDia of diasComData; let i = index; trackBy: trackByIndex" class="tabela-header-dia">
            {{ labelDia | uppercase }}
          </th>
        </tr>
      </thead>
      <tbody class="tabela-body">
        <tr *ngFor="let hora of horariosBaseSemana; trackBy: trackByHora" class="tabela-linha-horario">
          <td class="tabela-coluna-horario">
            {{ hora }}
          </td>
          <td *ngFor="let dia of diasDaSemana; trackBy: trackByDia" class="tabela-coluna-dia">
            <ng-container *ngIf="getHorarioStatus(dia, hora.trim()) as status">
              <ng-container [ngSwitch]="status.acao">
                <!-- Disponível para agendar -->
                <div *ngSwitchCase="'agendar'" class="tabela-botao-container">
                  <button
                    title="{{ hora }}"
                    mat-raised-button
                    class="tabela-botao-disponivel"
                    [color]="status.cor"
                    (click)="agendarCorte(getLabelDiaComData(dia), hora)"
                    [@agendarAnimacao]
                    [disabled]="desabilitarTodosOsBotoes()"
                  >
                    {{ status.texto.toUpperCase() }}
                  </button>
                </div>

                <!-- Agendado pelo usuário logado -->
                <div *ngSwitchCase="'cancelar'" class="tabela-botao-container">
                  <button
                    class="tabela-botao botao-agendado"
                    [disabled]="!isAgendamentoDesmarcavel(getAgendamentoParaDiaHora(dia, hora))"
                    (click)="handleClick(getAgendamentoParaDiaHora(dia, hora), dia, hora)"
                    [attr.title]="getTextTooltip(getAgendamentoParaDiaHora(dia, hora))"
                    [@cancelarAnimacao]
                  >
                    {{ status.texto.toUpperCase() }}
                  </button>
                </div>

                <!-- Agendado por outro usuário -->
                <div *ngSwitchCase="'ocupado'" class="tabela-botao-container">
                  <button
                    class="tabela-botao botao-agendado-outro"
                    disabled
                    title="Horário já agendado por outro usuário"
                  >
                    {{ status.texto.toUpperCase() }}
                  </button>
                </div>

                <!-- Indisponível -->
                <div *ngSwitchDefault class="tabela-horario-indisponivel" [attr.title]="feedbackMessageTitle || 'Este horário não está disponível nesta semana'">
                  <button mat-raised-button disabled class="tabela-botao-indisponivel">
                    {{ status.texto }}
                  </button>
                </div>
              </ng-container>
            </ng-container>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Seção de Detalhes dos Agendamentos -->
    <div class="agendamentos-detalhes">
      <h3>Detalhes dos Agendamentos</h3>
      <ng-container *ngIf="agendamentos.length > 0; else semAgendamentos">
        <table class="tabela-detalhes">
          <thead>
            <tr>
              <th>Data</th>
              <th>Hora</th>
              <th>Dia da Semana</th>
              <th>Categoria</th>
              <th>Militar</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let agendamento of agendamentos; trackBy: trackByAgendamento">
              <td>{{ agendamento.data }}</td>
              <td>{{ agendamento.hora }}</td>
              <td>{{ agendamento.diaSemana | uppercase }}</td>
              <td>{{ agendamento.categoria | titlecase }}</td>
              <td>
                <div *ngIf="agendamento.militar; else noMilitar">
                  <strong>SARAM:</strong> {{ agendamento.militar.saram || 'Não informado' }}<br>
                  <strong>Nome:</strong> {{ agendamento.militar.nomeCompleto || 'Não informado' }}<br>
                  <strong>Email:</strong> {{ agendamento.militar.email || 'Não informado' }}<br>
                  <strong>Seção:</strong> {{ agendamento.militar.secao || 'Não informado' }}<br>
                  <strong>Ramal:</strong> {{ agendamento.militar.ramal || 'Não informado' }}
                </div>
                <ng-template #noMilitar>
                  <div>Militar não encontrado</div>
                </ng-template>
              </td>
              <td>
                <button mat-icon-button color="warn"
                        *ngIf="isAgendamentoDoMilitarLogado(agendamento)"
                        (click)="desmarcarAgendamento(agendamento)">
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </ng-container>
      <ng-template #semAgendamentos>
        <p>Nenhum agendamento encontrado.</p>
      </ng-template>
    </div>
  </mat-card-content>
</mat-card>
