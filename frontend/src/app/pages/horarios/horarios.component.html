<app-admin-navbar [containerClass]="'horarios-container'" [categoria]="categoriaSelecionada">
  <mat-card class="horarios-card">
      <mat-card-content class="horarios-card-content">
        <!-- Cabeçalho: categoria à esquerda, botões à direita -->
        <div class="header-section">
          <h1 class="page-header">Horários - {{ categoriaSelecionada === 'OFICIAL' ? 'OFICIAIS' : 'GRADUADOS' }}</h1>
        </div>

        <!-- Aviso de agendamento -->
        <div class="info-panel icon-text" aria-label="Aviso de agendamento">
          <mat-icon>info</mat-icon>
          <span>Só é possível marcar uma vez a cada 15 dias.</span>
        </div>



      <div class="top-section">
        <div class="header-content-horizontal">
          <!-- Input + botões -->
          <div class="form-section" *ngIf="isAdmin">
            <div class="horario-actions">
              <mat-form-field appearance="fill" class="dia-field">
                <mat-label>Dia da Semana</mat-label>
                <mat-select [(ngModel)]="diaSelecionado" name="diaSelecionado" (selectionChange)="onDiaChange()">
                  <mat-option *ngFor="let dia of diasParaSelecao; trackBy: trackByDia" [value]="dia">
                    {{ dia === 'todos' ? 'Todos os dias' : (diaLabelMap[dia] | titlecase) }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="fill" class="horario-field">
                <mat-label>Adicionar/Remover Horário (HH:MM)</mat-label>
                <input
                  matInput
                  [(ngModel)]="horarioPersonalizado"
                  (input)="formatarHorario($event)"
                  placeholder="Ex.: 08:15"
                  required
                  maxlength="5"
                  [ngClass]="{'invalid': !horarioValido}"
                />
                <mat-error *ngIf="!horarioValido">
                  Digite um horário válido (HH:mm).
                </mat-error>
              </mat-form-field>

              <button mat-raised-button color="primary" (click)="adicionarHorarioBase()"
                [disabled]="!horarioValido || !horarioPersonalizado">
                Adicionar
              </button>
              <button mat-raised-button color="warn" (click)="removerHorarioBase()"
                [disabled]="!horarioValido || !horarioPersonalizado">
                Remover
              </button>
            </div>
          </div>

          <!-- Legenda -->
          <div class="legenda-section">
            <div class="legenda">
              <div class="legenda-item"><span><b>Legenda:</b></span></div>
              <div class="legenda-item">
                <div class="circulo primary"></div><span>Disponível</span>
              </div>
              <div class="legenda-item">
                <div class="circulo warn"></div><span>Indisponível</span>
              </div>
              <div class="legenda-item">
                <div class="circulo accent"></div><span>Agendado</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tabela de horários -->
      <div *ngIf="saramUsuario">
      <table class="horarios">
        <thead class="horarios-header">
          <tr>
            <th *ngFor="let dia of diasDaSemana; trackBy: trackByDia" class="horarios-header-dia" (click)="toggleDia(dia)" [class.clickable]="isAdmin">
              <span>{{ diaLabelMap[dia] | uppercase }}</span>
            </th>
          </tr>
        </thead>
        <tbody class="horarios-body">
          <tr *ngFor="let horario of horariosBaseSemana; trackBy: trackByHorario">
            <td *ngFor="let dia of diasDaSemana; trackBy: trackByDia" class="horarios-coluna-dia">
              <div class="horarios-botao-container">
                <!-- ADMIN -->
                <ng-container *ngIf="isAdmin; else visualizacaoUsuario">
                  <ng-container *ngIf="getSlot(dia, horario); else adicionar">
                    <button mat-raised-button
                            (click)="toggleHorario(dia, horario)"
                            [ngClass]="{
                              'botao-hora-disponivel': getStatus(dia, horario) === 'DISPONIVEL',
                              'botao-hora-indisponivel': getStatus(dia, horario) === 'INDISPONIVEL',
                              'botao-hora-agendado': getStatus(dia, horario) === 'AGENDADO'
                            }">
                      <ng-container [ngSwitch]="getStatus(dia, horario)">
                        <ng-container *ngSwitchCase="'AGENDADO'">
                          {{ formatarStatus('AGENDADO') }}
                        </ng-container>
                        <ng-container *ngSwitchDefault>
                          <b>{{ horario }}</b>
                        </ng-container>
                      </ng-container>
                    </button>
                  </ng-container>
                  <ng-template #adicionar>
                    <button mat-raised-button class="botao-hora-adicionar" color="accent"
                            (click)="adicionarHorarioIndividual(dia, horario, categoriaSelecionada)">
                      Adicionar
                    </button>
                  </ng-template>
                </ng-container>

            <!-- USUÁRIO -->
            <ng-template #visualizacaoUsuario>
              <ng-container *ngIf="getAgendamentoParaDiaHora(dia, horario) as agendamento">
                <button mat-raised-button
                        class="botao-hora-agendado"
                        [disabled]="!(isAgendamentoDoMilitarLogado(agendamento) && isAgendamentoDesmarcavel(agendamento))"
                        (click)="handleClick(agendamento)">
                  {{ formatarStatus('AGENDADO') }}
                </button>
              </ng-container>

              <button *ngIf="!getAgendamentoParaDiaHora(dia, horario) && getStatus(dia, horario) === 'DISPONIVEL'"
                      mat-raised-button
                      color="primary"
                      (click)="selecionarHorario(dia, horario)">
                {{ horario }}
              </button>

              <span *ngIf="!getAgendamentoParaDiaHora(dia, horario) && getStatus(dia, horario) === 'INDISPONIVEL'"
                    class="horario-indisponivel">
                Indisponível
              </span>

            </ng-template>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      </div>
      <div *ngIf="!horariosBaseSemana.length || isHorariosEmpty()" class="no-horarios">
        Nenhum horário encontrado
      </div>
    </mat-card-content>
  </mat-card>
</app-admin-navbar>
<div class="tabela-footer-padding"></div>

