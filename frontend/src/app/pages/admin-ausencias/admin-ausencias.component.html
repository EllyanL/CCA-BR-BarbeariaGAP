<app-admin-navbar [containerClass]="'ausencias-container'" [contentClass]="'ausencias-content'">
  <div class="filtros" *ngIf="!carregando">
    <mat-form-field appearance="outline" class="campo campo-texto">
      <mat-label>Buscar por posto ou nome</mat-label>
      <input
        matInput
        placeholder="Ex.: Sgt Silva"
        [(ngModel)]="filtroTexto"
        (ngModelChange)="aplicarFiltros()"
      />
      <button
        *ngIf="filtroTexto"
        mat-icon-button
        matSuffix
        aria-label="Limpar busca"
        (click)="limparCampo('texto')"
      >
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>

    <mat-form-field appearance="outline" class="campo campo-periodo">
      <mat-label>Período</mat-label>
      <mat-date-range-input [rangePicker]="picker">
        <input
          matStartDate
          [(ngModel)]="filtroDataInicio"
          (ngModelChange)="onDateRangeChange()"
          placeholder="Data inicial"
        />
        <input
          matEndDate
          [(ngModel)]="filtroDataFim"
          (ngModelChange)="onDateRangeChange()"
          placeholder="Data final"
        />
      </mat-date-range-input>
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-date-range-picker #picker></mat-date-range-picker>
    </mat-form-field>

    <mat-form-field appearance="outline" class="campo campo-status">
      <mat-label>Status</mat-label>
      <mat-select multiple [(ngModel)]="filtroStatus" (selectionChange)="aplicarFiltros()">
        <mat-option *ngFor="let status of statusOptions" [value]="status.value">
          {{ status.label }}
        </mat-option>
      </mat-select>
      <button
        *ngIf="filtroStatus.length"
        mat-icon-button
        matSuffix
        aria-label="Limpar status selecionados"
        (click)="limparCampo('status')"
      >
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>

    <button
      mat-stroked-button
      color="primary"
      class="botao-limpar"
      (click)="limparFiltros()"
      [disabled]="!temFiltros()"
    >
      Limpar filtros
    </button>
  </div>

  <div class="ausencias-wrapper" *ngIf="!carregando; else loading">
    <ng-container *ngIf="solicitacoes.length; else vazio">
      <ng-container *ngIf="solicitacoesFiltradas.length; else semResultados">
        <div class="lista">
          <mat-nav-list>
            <a
              mat-list-item
              *ngFor="let solicitacao of solicitacoesFiltradas"
              (click)="selecionar(solicitacao)"
              [class.selecionado]="selecionada?.id === solicitacao.id"
            >
              <div matLine>{{ tituloSolicitacao(solicitacao) }}</div>
              <div matLine class="status" [ngClass]="classeStatus(solicitacao.status)">
                {{ descricaoStatus(solicitacao) }}
              </div>
            </a>
          </mat-nav-list>
        </div>
        <div class="detalhe" *ngIf="selecionada; else selecione">
          <h2>Justificativa</h2>
          <p class="texto-justificativa">{{ selecionada?.justificativa }}</p>
          <div class="status-detalhe" [ngClass]="classeStatus(selecionada!.status)">
            Status: {{ descricaoStatus(selecionada!) }}
          </div>
          <div class="acoes" *ngIf="selecionada?.status === 'AGUARDANDO'">
            <button mat-raised-button color="primary" (click)="aprovarSelecionada()">
              Aprovar
            </button>
            <button mat-stroked-button color="warn" (click)="recusarSelecionada()">
              Recusar
            </button>
          </div>
        </div>
      </ng-container>
    </ng-container>
  </div>
</app-admin-navbar>

<ng-template #loading>
  <div class="estado">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Carregando justificativas...</p>
  </div>
</ng-template>

<ng-template #vazio>
  <div class="estado">
    <p>Nenhuma justificativa de ausência no momento.</p>
  </div>
</ng-template>

<ng-template #semResultados>
  <div class="estado">
    <p>Nenhuma justificativa encontrada com os filtros selecionados.</p>
    <button mat-stroked-button color="primary" (click)="limparFiltros()" [disabled]="!temFiltros()">
      Limpar filtros
    </button>
  </div>
</ng-template>

<ng-template #selecione>
  <div class="estado">
    <p>Selecione uma justificativa para visualizar os detalhes.</p>
  </div>
</ng-template>
